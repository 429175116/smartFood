<style lang="less">

</style>
<template>
<view class="login">
  <view class="logo">
    <!-- logo图片 -->
    <image class="img" src="/img/daw.jpg" />
  </view>
  <view class="form">
    <view class="set">
      <view class="iconfont icon-yonghu-tianchong"></view>
      <input type="number" placeholder="请输入用户名(电话)" value="{{userName}}" bindinput="getUserName" />
      <view class="iconfont icon-guanbi rightIcon" bindtap="delUserName"></view>
    </view>
    <view class="set">
      <view class="iconfont icon-mimaffffffpx"></view>
      <input type="{{passwordInputType}}" placeholder="请输入密码" value="{{userPaw}}" bindinput="getUserPaw" />
      <view class="iconfont icon-{{passwordIcon}} rightIcon" bindtap="showPassword"></view>
    </view>
    <view class="set">
      <view class="iconfont icon-mimaffffffpx"></view>
      <input type="{{passwordInputType2}}" placeholder="确认密码" value="{{userPaw2}}" bindinput="getUserPaw2" />
      <view class="iconfont icon-{{passwordIcon2}} rightIcon" bindtap="showPassword2"></view>
    </view>
    <view class="verification">
      <view class="iconfont icon-yanzhengma"></view>
      <input type="text" placeholder="请输入验证码" value="{{verificationCode}}" bindinput="setVerificationCode" />
      <view class="getCode" bindtap="getVerificationCode">
        <view>获取验证码</view>
      </view>
    </view>
    <view class="set sub">
      <view bindtap="submit">注册</view>
    </view>
  </view>
</view>
</template>

<script>
import wepy from 'wepy';
import nav from '../components/nav'; // 底部导航
export default class Registered extends wepy.page {
  config = {
    navigationBarTitleText: '注册'
  };
  components = {
    nav: nav
  };

  mixins = [];

  data = {
    userName: '',
    userPaw: '',
    userPaw2: '',
    verificationCode: '',
    passwordInputType: 'password',
    passwordIcon: 'in_zhengyan',
    passwordInputType2: 'password',
    passwordIcon2: 'in_zhengyan'
  };

  computed = {}

  methods = {
    getVerificationCode() {
      if (this.check.isPhone(this.data.userName)) {
        wx.showModal({
          title: '',
          content: '请输入正确的手机号'
        })
        return ''
      }
      // 获取验证码
      console.log('获取验证码')
    },
    getUserName(e) {
      this.setData({
        userName: e.detail.value
      })
    },
    getUserPaw(e) {
      this.setData({
        userPaw: e.detail.value
      })
    },
    getUserPaw2(e) {
      this.setData({
        userPaw2: e.detail.value
      })
    },
    setVerificationCode(e) {
      this.setData({
        verificationCode: e.detail.value
      })
    },
    delUserName() {
      this.setData({
        userName: ''
      })
    },
    showPassword() {
      if (this.data.passwordInputType == 'password') {
        this.setData({
          passwordInputType: 'text',
          passwordIcon: 'biyan'
        })
      } else {
        this.setData({
          passwordInputType: 'password',
          passwordIcon: 'zhengyan'
        })
      }
    },
    showPassword2() {
      if (this.data.passwordInputType2 == 'password') {
        this.setData({
          passwordInputType2: 'text',
          passwordIcon2: 'biyan'
        })
      } else {
        this.setData({
          passwordInputType2: 'password',
          passwordIcon2: 'zhengyan'
        })
      }
    },
    submit() {
      // console.log('提交')
      if (this.check.isPhone(this.data.userName)) {
        wx.showModal({
          title: '',
          content: '请输入正确的账号'
        })
        return ''
      }
      if (this.check.isNull(this.data.userPaw)) {
        wx.showModal({
          title: '',
          content: '请输入密码'
        })
        return ''
      }
      if (this.data.userPaw.length < 6 || this.data.userPaw.length > 15) {
        wx.showModal({
          title: '',
          content: '密码长度为6-15位'
        })
        return ''
      }
      if (this.data.userPaw !== this.data.userPaw2) {
        wx.showModal({
          title: '',
          content: '两次输入的密码不同'
        })
        return ''
      }
      if (this.check.isNull(this.data.verificationCode)) {
        wx.showModal({
          title: '',
          content: '请输入验证码'
        })
        return ''
      }
      
      return
      wx.request({
        url: `${app.globalData.requestUrl}/api/login`,
        method: 'POST',
        data: {
          mobile: this.data.userName,
          password: this.data.userPaw,
          code: this.data.verificationCode
        },
        success: data => {
          if (data.code !== '0') {
            // 返回登录页
            wx.navigateBack()
          } else {
            wx.showModal({
              title: '',
              content: data.msg
            })
          }
        }
      })
      // 
    }
  }

  events = {}

  onLoad() {
    this.getUserLoginInfo()
  }
}
</script>
